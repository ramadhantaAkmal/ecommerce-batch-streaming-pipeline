version: 2

models:
  - name: mart_payment_method_analysis
    description: |
      Monthly payment method performance mart.
      Answers: Which payment methods drive real revenue? Which have highest fraud?
      Essential for Finance, Risk, and Product teams.

    columns:
      - name: payment_method
        description: "card, ewallet, bank_transfer, etc."
        tests:
          - not_null

      - name: total_orders
      - name: genuine_orders
        description: "Real, non-fraud orders"
      - name: fraud_orders

      - name: gross_gmv
      - name: net_revenue
        description: "Revenue from GENUINE orders only â†’ what actually lands in the bank"

      - name: aov_genuine
        description: "Average order value of genuine transactions"

      - name: fraud_rate
        description: "Critical risk KPI per payment method"
      - name: genuine_rate

    tests:
      - dbt_utils.expression_is_true:
          expression: "fraud_rate BETWEEN 0 AND 1"
      - dbt_utils.expression_is_true:
          expression: "genuine_rate + fraud_rate >= 0.99" 
      - dbt_utils.expression_is_true:
          expression: "revenue_share_of_total BETWEEN 0 AND 1"